---
title: "Data Journalism"
author: "Eve Sampson"
output:
  pdf_document:
    toc: yes
  html_document:
    theme: cerulean
    highlight: pygments
    toc: yes
    toc_float:
      collapsed: yes
      smooth_scroll: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

Consider this my personal guide to the commands and functions you will learn. In general, when you come across an R command or function that you want to remember, put it in here along with a description of what it does and when you'd use it.

Jan 27
to set a working directory - click on "more" under the file explorer on the right and click "set as working directory. Here is the command:
setwd("")

to install packages: install.packages("")

in every single notebook we use, you have to do this: library("tidyverse")

head() gives you the first 6 rows of a file
glimpse() gives you a literal glimpse of the data - what types, etc.
group_by() and you input the name of the column you want to sort - example below:
  
```{r}
ppp_maryland_loans %>%
  group_by(project_county_name) %>%
  summarise(
    count_loans = n()
  )
```

See where the most loans are by county (count the number of loans in that group, and then sort so the county with the highest number of loans is listed first.)
```{r}
ppp_maryland_loans %>%
  group_by(project_county_name) %>%
  summarise(
    count_loans = n()
  ) %>%
  arrange(desc(count_loans))
```

county and race, then count the number of loans in that group, and then sort from A-Z by county and then by race.
```{r}
ppp_maryland_loans %>%
  group_by(project_county_name,race) %>%
  summarise(
    count_loans = n()
  ) %>%
  arrange(project_county_name,race)
```


by the county for each loan, and then count the number of loans in that group and add up the value of all loans in that group. Then sort so the county with the highest total loan dollar amount is listed first.
```{r}
ppp_maryland_loans %>%
  group_by(project_county_name) %>%
  summarise(
    count_loans = n(),
    total_loans_amount = sum(amount)
  ) %>%
  arrange(desc(total_loans_amount))
```

count the number of loans , add up the value of all loans, and calculate the mean and median loan amounts. Then sort so the county with the highest mean dollar amount is listed first.
```{r}
ppp_maryland_loans %>%
  group_by(project_county_name) %>%
  summarise(
    count_loans = n(),
    total_loans_amount = sum(amount),
    mean_loan_amount = mean(amount),
    median_loan_amount = median(amount)
  ) %>%
  arrange(desc(mean_loan_amount))
```

to run code:
```{r}
library("tidyverse")
```

arrange(max_loan) = ascending order
arrange(desc(max_loan)) = descending order

Reads in a spreadsheet and converts to a dataframe
```{r}
maryland_ppp <- read_csv('data/ppp_applications_md.csv.zip')
```


To create a new column
```{r}
maryland_ppp %>%
  select(loan_number, amount, payroll_proceed) %>%
  mutate(
  percent_payroll = payroll_proceed/amount
)
```
See below explanation
```{r}
maryland_ppp %>%
  select(loan_number, amount, payroll_proceed) %>%
  # mutate(
  #new column = value
#)

```

select(info) - this means show me only this

to get a count of in/out of state
maryland_with_in_out %>% group_by(in_out) %>% summarize(count =(
))


### Task 16: Use mutate and lubridate to add a column called `Month` and see which month had the most applications.
**Task** Run the following code to create a new column based on `date_approved`. Add a description of what this code does to your reference notebook.

```{r}
maryland_ppp %>%
  mutate(Month = floor_date(date_approved, "month")) %>%
  group_by(Month) %>%
  summarise(total = n()) %>%
  arrange(desc(total))
```


**Task** Run the following code to create a new column called `in_out` based on the values of `servicing_lender_state`. Add a description of what this code does to your reference notebook.

```{r}
# if/else example
maryland_with_in_out <- maryland_ppp %>%
  mutate(
    in_out = if_else(
        servicing_lender_state == 'MD', "IN", "OUT"
      )
  )
```


function to change cases:
maryland_ppp <- maryland_ppp %>% mutate(projext_city = str_to_upper(project_city))

how to filter NAs
maryland_ppp %>% filter(is.na(project_county_name))

read.csv versus read_csv read.csv doesn't presume too much - is more conservative in its estimates (something looks like a date but not sure so call it a character) - this is where lubridate comes in

This code standardizes a number to specific number of digits.
```{r}
# cleaning function
cleaned_arnold_md_loans <- arnold_md_loans %>%
  clean_names() %>%
  rename(id = x1_id) %>%
  mutate(amount = as.numeric(amount)) %>%
  distinct() %>%
  mutate(zip = str_sub(zip, start=1L, end=5L))


# display the cleaned dataset
cleaned_arnold_md_loans

```

Descriptor: eliminates duplicate rows

```{r}
# cleaning function
cleaned_arnold_md_loans <- arnold_md_loans %>%
  clean_names() %>%
  rename(id = x1_id) %>%
  mutate(amount = as.numeric(amount)) %>%
  distinct()


# display the cleaned dataset
cleaned_arnold_md_loans

```

```{r}
# cleaning function
cleaned_arnold_md_loans <- arnold_md_loans %>%
  clean_names() %>%
  rename(id = x1_id)

# display the cleaned dataset
cleaned_arnold_md_loans


```



my_result <- original data %>%
  filter(some_column == "some value") %>%
  mutate()
  group_by(some_column) %>%
  summarise ()
  arrange(desc())
  
  
  loan_plot = ggplot(question_1_data,aes(x=date_approved, y=total_loans)) +
  geom_point() +
  geom_line() + 
  scale_x_date(breaks = "1 day", limits = c(as.Date("2020-04-01")+1,as.Date("2020-04-30"))) +
  theme(
    axis.text.x = element_text(angle = 45,  hjust=1) 
  )
  
  loan_plot